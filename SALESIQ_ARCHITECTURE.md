# Zoho SalesIQ Integration Architecture

## System Architecture Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                         â”‚
â”‚                         ZOHO SALESIQ (Frontend)                        â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Chat Widget                                                     â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
â”‚  â”‚  â”‚  User: "How do I reset my password?"                   â”‚   â”‚  â”‚
â”‚  â”‚  â”‚  Bot: "Follow these steps..."                           â”‚   â”‚  â”‚
â”‚  â”‚  â”‚                                                         â”‚   â”‚  â”‚
â”‚  â”‚  â”‚  [Input Field] [Send Button] [Escalate Button]         â”‚   â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
â”‚  â”‚                                                                  â”‚  â”‚
â”‚  â”‚  Bot Configuration                                             â”‚  â”‚
â”‚  â”‚  â”œâ”€ Incoming Message Trigger                                   â”‚  â”‚
â”‚  â”‚  â”œâ”€ Webhook Action                                             â”‚  â”‚
â”‚  â”‚  â”œâ”€ Response Mapping                                           â”‚  â”‚
â”‚  â”‚  â””â”€ Escalation Rules                                           â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                    Webhook POST /salesiq/chat
                                 â”‚
                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                         â”‚
â”‚                    ACEBUDDY RAG CHATBOT (Backend)                       â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  FastAPI Server (Port 8000)                                      â”‚  â”‚
â”‚  â”‚                                                                  â”‚  â”‚
â”‚  â”‚  /salesiq/chat          â† Main endpoint                          â”‚  â”‚
â”‚  â”‚  /salesiq/webhook       â† Alternative webhook                    â”‚  â”‚
â”‚  â”‚  /salesiq/status        â† Health check                           â”‚  â”‚
â”‚  â”‚  /salesiq/analytics     â† Metrics                                â”‚  â”‚
â”‚  â”‚  /salesiq/batch         â† Batch processing                       â”‚  â”‚
â”‚  â”‚  /chat                  â† Original chat endpoint                 â”‚  â”‚
â”‚  â”‚  /health                â† Server health                          â”‚  â”‚
â”‚  â”‚                                                                  â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
â”‚  â”‚  â”‚ Request Handler                                         â”‚   â”‚  â”‚
â”‚  â”‚  â”‚ {                                                       â”‚   â”‚  â”‚
â”‚  â”‚  â”‚   "query": "How to reset password?",                   â”‚   â”‚  â”‚
â”‚  â”‚  â”‚   "visitor_id": "visitor_123",                         â”‚   â”‚  â”‚
â”‚  â”‚  â”‚   "chat_id": "chat_456",                               â”‚   â”‚  â”‚
â”‚  â”‚  â”‚   "email": "user@example.com"                          â”‚   â”‚  â”‚
â”‚  â”‚  â”‚ }                                                       â”‚   â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
â”‚  â”‚                         â”‚                                        â”‚  â”‚
â”‚  â”‚                         â–¼                                        â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚ Processing Pipeline                                      â”‚  â”‚  â”‚
â”‚  â”‚  â”‚                                                          â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  1. Intent Classification                              â”‚  â”‚  â”‚
â”‚  â”‚  â”‚     â””â”€ "account_management" (80% confidence)           â”‚  â”‚  â”‚
â”‚  â”‚  â”‚                                                          â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  2. Query Enhancement                                  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚     â”œâ”€ Add synonyms                                    â”‚  â”‚  â”‚
â”‚  â”‚  â”‚     â”œâ”€ Expand abbreviations                            â”‚  â”‚  â”‚
â”‚  â”‚  â”‚     â””â”€ 3 query variations total                        â”‚  â”‚  â”‚
â”‚  â”‚  â”‚                                                          â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  3. Vector Search                                      â”‚  â”‚  â”‚
â”‚  â”‚  â”‚     â”œâ”€ Generate embedding (1536-d)                    â”‚  â”‚  â”‚
â”‚  â”‚  â”‚     â”œâ”€ Search Chroma collection                        â”‚  â”‚  â”‚
â”‚  â”‚  â”‚     â””â”€ Top 5 results (76% â†’ 33% confidence)           â”‚  â”‚  â”‚
â”‚  â”‚  â”‚                                                          â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  4. Context Formatting                                 â”‚  â”‚  â”‚
â”‚  â”‚  â”‚     â”œâ”€ [Source 1]: Account reset guide                â”‚  â”‚  â”‚
â”‚  â”‚  â”‚     â”œâ”€ [Source 2]: Password policies                  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚     â””â”€ [Source 3]: 2FA setup                          â”‚  â”‚  â”‚
â”‚  â”‚  â”‚                                                          â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  5. LLM Generation                                     â”‚  â”‚  â”‚
â”‚  â”‚  â”‚     â”œâ”€ Build prompt with context                       â”‚  â”‚  â”‚
â”‚  â”‚  â”‚     â”œâ”€ Include conversation history                    â”‚  â”‚  â”‚
â”‚  â”‚  â”‚     â”œâ”€ Call Ollama OR OpenAI                          â”‚  â”‚  â”‚
â”‚  â”‚  â”‚     â””â”€ Generate 512 tokens max                         â”‚  â”‚  â”‚
â”‚  â”‚  â”‚                                                          â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  6. Response Validation                                â”‚  â”‚  â”‚
â”‚  â”‚  â”‚     â”œâ”€ Quality scoring                                 â”‚  â”‚  â”‚
â”‚  â”‚  â”‚     â”œâ”€ Confidence calculation                          â”‚  â”‚  â”‚
â”‚  â”‚  â”‚     â””â”€ Escalation decision                             â”‚  â”‚  â”‚
â”‚  â”‚  â”‚                                                          â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  7. Conversation Logging                               â”‚  â”‚  â”‚
â”‚  â”‚  â”‚     â””â”€ Store in conversation history                   â”‚  â”‚  â”‚
â”‚  â”‚  â”‚                                                          â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚                         â”‚                                        â”‚  â”‚
â”‚  â”‚                         â–¼                                        â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚ Response Object                                          â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ {                                                        â”‚  â”‚  â”‚
â”‚  â”‚  â”‚   "answer": "To reset your password...",                â”‚  â”‚  â”‚
â”‚  â”‚  â”‚   "confidence": 0.85,                                   â”‚  â”‚  â”‚
â”‚  â”‚  â”‚   "should_escalate": false,                             â”‚  â”‚  â”‚
â”‚  â”‚  â”‚   "response_quality": 0.80,                             â”‚  â”‚  â”‚
â”‚  â”‚  â”‚   "sources": [                                          â”‚  â”‚  â”‚
â”‚  â”‚  â”‚     {                                                   â”‚  â”‚  â”‚
â”‚  â”‚  â”‚       "title": "account_reset.md",                      â”‚  â”‚  â”‚
â”‚  â”‚  â”‚       "confidence": 0.92                                â”‚  â”‚  â”‚
â”‚  â”‚  â”‚     }                                                   â”‚  â”‚  â”‚
â”‚  â”‚  â”‚   ],                                                    â”‚  â”‚  â”‚
â”‚  â”‚  â”‚   "session_id": "chat_456"                              â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ }                                                        â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚                                                                  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Vector Database (Chroma)                                         â”‚  â”‚
â”‚  â”‚                                                                  â”‚  â”‚
â”‚  â”‚  Collection: acebuddy_kb                                       â”‚  â”‚
â”‚  â”‚  Documents: 100 (92 original + 8 PDF chunks)                   â”‚  â”‚
â”‚  â”‚  Embedding Model: text-embedding-3-small (1536-d)              â”‚  â”‚
â”‚  â”‚  Storage: data/chroma/ (persistent)                            â”‚  â”‚
â”‚  â”‚                                                                  â”‚  â”‚
â”‚  â”‚  Sample Documents:                                             â”‚  â”‚
â”‚  â”‚  â”œâ”€ WebDAV Setup (2 chunks)                                   â”‚  â”‚
â”‚  â”‚  â”œâ”€ QuickBooks Email (2 chunks)                               â”‚  â”‚
â”‚  â”‚  â”œâ”€ Remote App Setup (2 chunks)                               â”‚  â”‚
â”‚  â”‚  â”œâ”€ QuickBooks Reports (2 chunks)                             â”‚  â”‚
â”‚  â”‚  â”œâ”€ Original KB (92 documents)                                â”‚  â”‚
â”‚  â”‚  â””â”€ [... more documents]                                      â”‚  â”‚
â”‚  â”‚                                                                  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ LLM Service                                                      â”‚  â”‚
â”‚  â”‚                                                                  â”‚  â”‚
â”‚  â”‚  Option 1: Ollama (Local)                                      â”‚  â”‚
â”‚  â”‚  â”œâ”€ Model: llama3.2:1b (fast)                                  â”‚  â”‚
â”‚  â”‚  â”œâ”€ Port: 11434                                                â”‚  â”‚
â”‚  â”‚  â”œâ”€ Response time: 2-5 seconds                                 â”‚  â”‚
â”‚  â”‚  â””â”€ Temperature: 0.7 (balanced)                                â”‚  â”‚
â”‚  â”‚                                                                  â”‚  â”‚
â”‚  â”‚  Option 2: OpenAI API (Cloud)                                  â”‚  â”‚
â”‚  â”‚  â”œâ”€ Model: gpt-4o-mini                                         â”‚  â”‚
â”‚  â”‚  â”œâ”€ Response time: 1-3 seconds                                 â”‚  â”‚
â”‚  â”‚  â”œâ”€ Temperature: 0.2 (focused)                                 â”‚  â”‚
â”‚  â”‚  â””â”€ Cost: ~$0.001 per query                                    â”‚  â”‚
â”‚  â”‚                                                                  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Supporting Services                                              â”‚  â”‚
â”‚  â”‚                                                                  â”‚  â”‚
â”‚  â”‚  â”œâ”€ Conversation Manager      â†’ Stores chat history            â”‚  â”‚
â”‚  â”‚  â”œâ”€ Query Enhancer           â†’ Rewrites/expands queries        â”‚  â”‚
â”‚  â”‚  â”œâ”€ Intent Classifier        â†’ Categorizes user intent         â”‚  â”‚
â”‚  â”‚  â”œâ”€ Response Validator       â†’ Quality scoring                 â”‚  â”‚
â”‚  â”‚  â”œâ”€ Semantic Cache           â†’ Caches embeddings               â”‚  â”‚
â”‚  â”‚  â””â”€ Analytics Tracker        â†’ Logs interactions               â”‚  â”‚
â”‚  â”‚                                                                  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                    Response (JSON) back to SalesIQ
                                 â”‚
                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                         â”‚
â”‚                         ZOHO SALESIQ (Display)                         â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Chat Widget - Response Display                                  â”‚  â”‚
â”‚  â”‚                                                                  â”‚  â”‚
â”‚  â”‚  Bot: "To reset your password, follow these steps:             â”‚  â”‚
â”‚  â”‚        1. Go to Account Settings...                            â”‚  â”‚
â”‚  â”‚        2. Click 'Reset Password'...                            â”‚  â”‚
â”‚  â”‚        3. Enter new password..."                               â”‚  â”‚
â”‚  â”‚                                                                  â”‚  â”‚
â”‚  â”‚  [Helpful ğŸ‘] [Not Helpful ğŸ‘] [Escalate to Agent]             â”‚  â”‚
â”‚  â”‚                                                                  â”‚  â”‚
â”‚  â”‚  Metadata (optional display):                                   â”‚  â”‚
â”‚  â”‚  Confidence: 85% | Sources: account_reset.md                   â”‚  â”‚
â”‚  â”‚                                                                  â”‚  â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                      â”‚  â”‚
â”‚  â”‚                                                                  â”‚  â”‚
â”‚  â”‚  User Follow-up: "How long does it take?"                       â”‚  â”‚
â”‚  â”‚  â”‚                                                              â”‚  â”‚
â”‚  â”‚  â–¼ [Uses session history for context]                          â”‚  â”‚
â”‚  â”‚                                                                  â”‚  â”‚
â”‚  â”‚  Bot: "Password resets typically take 5-10 minutes..."         â”‚  â”‚
â”‚  â”‚                                                                  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                         â”‚
â”‚  OR (If escalation needed)                                             â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Human Agent Chat                                                â”‚  â”‚
â”‚  â”‚                                                                  â”‚  â”‚
â”‚  â”‚  Bot: "I'm not sure about that. Let me connect you with a      â”‚  â”‚
â”‚  â”‚        specialist who can help you better."                     â”‚  â”‚
â”‚  â”‚                                                                  â”‚  â”‚
â”‚  â”‚  [Transferring to agent...]                                     â”‚  â”‚
â”‚  â”‚                                                                  â”‚  â”‚
â”‚  â”‚  Agent John: "Hi! I'm John from support. How can I help?"      â”‚  â”‚
â”‚  â”‚                                                                  â”‚  â”‚
â”‚  â”‚  [Chat continues with human agent]                              â”‚  â”‚
â”‚  â”‚                                                                  â”‚  â”‚
â”‚  â”‚  [Chat transcript saved for future ML training]                 â”‚  â”‚
â”‚  â”‚                                                                  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Data Flow Sequence

```
1. User Types Message
   â””â”€â†’ SalesIQ Chat Widget captures text

2. SalesIQ Sends Webhook
   â””â”€â†’ POST /salesiq/chat with visitor_id, chat_id, message

3. AceBuddy Receives Request
   â””â”€â†’ FastAPI handler processes incoming data

4. Intent Detection
   â””â”€â†’ Classify user intent (account, technical, billing, etc.)

5. Query Enhancement
   â””â”€â†’ Add synonyms and variations to improve search

6. Vector Search
   â””â”€â†’ Generate embeddings â†’ Search Chroma â†’ Get 5 results

7. LLM Prompt Building
   â””â”€â†’ Format context + conversation history + question

8. Response Generation
   â””â”€â†’ Call Ollama or OpenAI with prompt

9. Quality Validation
   â””â”€â†’ Score confidence and quality

10. Escalation Decision
    â”œâ”€ If confidence â‰¥ 0.7 â†’ Send to user
    â””â”€ If confidence < 0.7 â†’ Escalate to human

11. Response Sent Back
    â””â”€â†’ JSON with answer, confidence, sources

12. SalesIQ Displays Response
    â””â”€â†’ User sees answer in chat

13. User Feedback (Optional)
    â””â”€â†’ Helpful/Not Helpful â†’ Recorded for analytics

14. Conversation Logged
    â””â”€â†’ Stored for future training
```

---

## Component Interaction

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SalesIQ Webhook     â”‚
â”‚  Request             â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ salesiq_integration.py               â”‚
â”‚ â”œâ”€ validate_request()                â”‚
â”‚ â”œâ”€ format_for_salesiq()              â”‚
â”‚ â””â”€ should_escalate_to_human()        â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ app/main.py                          â”‚
â”‚ â”œâ”€ chat() function                   â”‚
â”‚ â”‚  â”œâ”€ Intent Classification          â”‚
â”‚ â”‚  â”œâ”€ Query Enhancement              â”‚
â”‚ â”‚  â”œâ”€ Context Retrieval              â”‚
â”‚ â”‚  â”œâ”€ LLM Generation                 â”‚
â”‚ â”‚  â””â”€ Response Validation            â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                 â”‚                      â”‚
       â–¼                 â–¼                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ intent.py      â”‚ â”‚ Chroma Vector  â”‚ â”‚ LLM Service      â”‚
â”‚ (Classify)     â”‚ â”‚ Database       â”‚ â”‚ (Ollama/OpenAI)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                 â”‚                      â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚ Response Validator   â”‚
       â”‚ (Quality Score)      â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚ Format Response      â”‚
       â”‚ (SalesIQ Format)     â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚ Send Back to SalesIQ â”‚
       â”‚ (200 OK)             â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚ SalesIQ Displays     â”‚
       â”‚ Answer to User       â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Decision Tree: Escalation Logic

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Got Response from LLM?          â”‚
â”œâ”€ Yes â†’ Continue                â”‚
â””â”€ No â†’ ESCALATE (API Error)     â”‚
                                  
                                  
Yes â†’ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚ Confidence â‰¥ 0.7?      â”‚
      â”œâ”€ Yes â†’ Continue       â”‚
      â””â”€ No â†’ ESCALATE        â”‚
                               
                               
Yes â†’ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚ Quality â‰¥ 0.6?         â”‚
      â”œâ”€ Yes â†’ Continue       â”‚
      â””â”€ No â†’ ESCALATE        â”‚
                               
                               
Yes â†’ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚ Context Found?         â”‚
      â”œâ”€ Yes â†’ SEND ANSWER     â”‚
      â””â”€ No â†’ ESCALATE        â”‚
                               
                               
ESCALATE â†’ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚ Transfer to Human Agent              â”‚
           â”œâ”€ Keep conversation context          â”‚
           â”œâ”€ Log interaction for training       â”‚
           â””â”€ Track escalation reason            â”‚
                                                 
                                                 
SEND ANSWER â†’ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ Display to User                  â”‚
              â”œâ”€ Show confidence (optional)      â”‚
              â”œâ”€ Show sources (optional)         â”‚
              â”œâ”€ Show [Helpful] buttons          â”‚
              â””â”€ Log interaction                 â”‚
```

---

## Deployment Architecture

```
PRODUCTION DEPLOYMENT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

                    Internet
                        â–²
                        â”‚ HTTPS
                        â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚               â”‚               â”‚
        â–¼               â–¼               â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Nginx  â”‚      â”‚ Nginx  â”‚     â”‚ Nginx  â”‚
    â”‚ Proxy  â”‚      â”‚ Proxy  â”‚     â”‚ Proxy  â”‚
    â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
        â”‚               â”‚              â”‚
        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
        â”‚               â”‚              â”‚
        â–¼               â–¼              â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Docker Container - AceBuddy API       â”‚
    â”‚  â”œâ”€ FastAPI Server (0.0.0.0:8000)     â”‚
    â”‚  â”œâ”€ SalesIQ Integration Enabled        â”‚
    â”‚  â””â”€ Connected to persistent volumes    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                                   â”‚
        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
        â”‚               â”‚              â”‚    â”‚
        â–¼               â–¼              â–¼    â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
    â”‚Chroma  â”‚   â”‚ Cache  â”‚    â”‚ Logs   â”‚ â”‚
    â”‚Vector  â”‚   â”‚ (Redis)â”‚    â”‚(File)  â”‚ â”‚
    â”‚DB      â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             â”‚
        â”‚                                   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Docker Container - Ollama (Optional)  â”‚
    â”‚  â”œâ”€ Ollama Server (:11434)             â”‚
    â”‚  â”œâ”€ Models: llama3.2:1b (or others)    â”‚
    â”‚  â””â”€ GPU Acceleration (if available)    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    External Services:
    â”œâ”€ OpenAI API (if USE_OPENAI=true)
    â”œâ”€ Zoho SalesIQ (webhook callbacks)
    â””â”€ Optional: Slack, email notifications
```

---

## Data Storage Layout

```
data/
â”œâ”€â”€ chroma/                      â† Persistent Vector DB
â”‚   â”œâ”€â”€ chroma.sqlite3           â† Index database
â”‚   â”œâ”€â”€ 0/                       â† Data partition
â”‚   â””â”€â”€ ...
â”‚
â”œâ”€â”€ manual_kb_chunks.json        â† 8 PDF chunks + embeddings
â”œâ”€â”€ atomic_chunks.json           â† All chunks
â”‚
â”œâ”€â”€ kb/                          â† Original KB articles
â”‚   â”œâ”€â”€ 01_password_reset.md
â”‚   â”œâ”€â”€ 02_disk_storage.md
â”‚   â””â”€â”€ ...
â”‚
â”œâ”€â”€ kb_downloads/
â”‚   â””â”€â”€ cleaned_manual/          â† 4 cleaned PDF texts
â”‚       â”œâ”€â”€ webdav.txt
â”‚       â”œâ”€â”€ quickbooks_email.txt
â”‚       â”œâ”€â”€ remote_app.txt
â”‚       â””â”€â”€ quickbooks_export.txt
â”‚
â”œâ”€â”€ salesiq_config.json          â† SalesIQ configuration
â””â”€â”€ salesiq_webhooks.json        â† Webhook URLs
```

---

*Architecture Diagram - Zoho SalesIQ Integration*  
*Updated: November 18, 2025*
